<!-- index.html -->
<!DOCTYPE html>
<html>
  <head>
    <title>Passaporto Polling</title>
  </head>
  <body>
    <h2>Enter Cookies</h2>
    <div>
      <label for="agpid_fe">AGPID_FE:</label>
      <input type="text" id="agpid_fe" name="agpid_fe">
      <br>
      <br />
      <label for="agpid">AGPID:</label>
      <input type="text" id="agpid" name="agpid">
      <br>
      <br />
      <label for="jsessionid">JSESSIONID:</label>
      <input type="text" id="jsessionid" name="jsessionid">
      <br>
      <br />
      <input type="button" value="Submit" id="submitButton">
    </div>
    <p id="response"></p>
    <script>
      document.getElementById("submitButton").addEventListener("click", function() {
        var agpid_fe = encodeURIComponent(document.getElementById("agpid_fe").value);
        var agpid = encodeURIComponent(document.getElementById("agpid").value);
        var jsessionid = encodeURIComponent(document.getElementById("jsessionid").value);
        // Combine the values into one string
        var cookies = "AGPID_FE=" + agpid_fe + "&AGPID=" + agpid + "&JSESSIONID=" + jsessionid;
        // Send a POST request to the trigger endpoint with the combined cookies
        fetch('/trigger?' + cookies).then(response => response.text()).then(data => {
          document.getElementById("response").innerHTML = data;
        }).catch(error => {
          console.error('Error:', error);
        });
      });
    </script>
    <hr />
    <p>Questa pagina serve per dare una svegliata al bot quando si ferma per cookies di SPID scaduti. Chiunque può usare il proprio SPID per compilare i tre campi sopra e riattivare il bot. </p>
    <p>Puoi recuperare questi cookies accedendo al <a href="https://www.passaportonline.poliziadistato.it">sito del passaporto</a> col tuo SPID e poi cliccando tasto destro --> "Ispeziona". Viene aperto un riquadro come quello qui sotto, i cookies richeisti si trovano nella tab "Application".</p>
    <br />
    <img src="https://raw.githubusercontent.com/GaussGreen1/Passaporto/main/cookies.jpg" alt="img">
    <br />
    <br />
    <hr />
    <hr />
    <h2>Backend Logs:</h2>
	<p>Se il bot è attivo, sotto questa scritta verrà aggiornato il suo stato ogni 30 secondi. Se qui sotto non c'è scritto nulla o sembra tutto fermo allora va riattivato passandogli i cookies come sopra.</p> 
    <br>
    <br />
	<div id="log-container"></div>
    <script>
      // Function to connect to the WebSocket endpoint and display log messages
      function connectWebSocket() {
        var socketProtocol = window.location.protocol === 'https:' ? 'wss:' : 'ws:';
        var socket = new WebSocket(socketProtocol + "//" + window.location.host + "/ws");
        // Array to store the log lines
        var logLines = [];
        socket.onmessage = function(event) {
          var logContainer = document.getElementById("log-container");
          // Add the log message to the array
          logLines.push(event.data);
          // Show only the last 10 log lines
          if (logLines.length > 10) {
            logLines.shift(); // Remove the first element (oldest log line) from the array
          }
          // Set the innerHTML of the log container to display the last 10 log lines
          logContainer.innerHTML = logLines.join(" <br> ");
        };
        socket.onclose = function(event) {
          // Reconnect after 3 seconds when the WebSocket connection is closed
          setTimeout(connectWebSocket, 3000);
        };
      }
      connectWebSocket();
    </script>
  </body>
</html>